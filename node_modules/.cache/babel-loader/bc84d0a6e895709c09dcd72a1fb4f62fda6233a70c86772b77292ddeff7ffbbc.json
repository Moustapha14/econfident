{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __assign, __awaiter, __generator, __read } from \"tslib\";\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\nimport { Buffer } from 'buffer';\nimport { isCognitoHostedOpts, CognitoHostedUIIdentityProvider } from '../types/Auth';\nimport { ConsoleLogger as Logger, Hub, urlSafeEncode } from '@aws-amplify/core';\nimport { Sha256 } from '@aws-crypto/sha256-js';\nvar AMPLIFY_SYMBOL = typeof Symbol !== 'undefined' && typeof Symbol.for === 'function' ? Symbol.for('amplify_default') : '@@amplify_default';\nvar dispatchAuthEvent = function (event, data, message) {\n  Hub.dispatch('auth', {\n    event: event,\n    data: data,\n    message: message\n  }, 'Auth', AMPLIFY_SYMBOL);\n};\nvar logger = new Logger('OAuth');\nvar OAuth = /** @class */function () {\n  function OAuth(_a) {\n    var config = _a.config,\n      cognitoClientId = _a.cognitoClientId,\n      _b = _a.scopes,\n      scopes = _b === void 0 ? [] : _b;\n    this._urlOpener = config.urlOpener || launchUri;\n    this._config = config;\n    this._cognitoClientId = cognitoClientId;\n    if (!this.isValidScopes(scopes)) throw Error('scopes must be a String Array');\n    this._scopes = scopes;\n  }\n  OAuth.prototype.isValidScopes = function (scopes) {\n    return Array.isArray(scopes) && scopes.every(function (scope) {\n      return typeof scope === 'string';\n    });\n  };\n  OAuth.prototype.oauthSignIn = function (responseType, domain, redirectSignIn, clientId, provider, customState) {\n    if (responseType === void 0) {\n      responseType = 'code';\n    }\n    if (provider === void 0) {\n      provider = CognitoHostedUIIdentityProvider.Cognito;\n    }\n    var generatedState = this._generateState(32);\n    /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n    single-encodes/decodes url on first sign in and double-encodes/decodes url\n    when user already signed in. Using encodeURIComponent, Base32, Base64 add\n    characters % or = which on further encoding becomes unsafe. '=' create issue\n    for parsing query params.\n    Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n    var state = customState ? generatedState + \"-\" + urlSafeEncode(customState) : generatedState;\n    oAuthStorage.setState(state);\n    var pkce_key = this._generateRandom(128);\n    oAuthStorage.setPKCE(pkce_key);\n    var code_challenge = this._generateChallenge(pkce_key);\n    var code_challenge_method = 'S256';\n    var scopesString = this._scopes.join(' ');\n    var queryString = Object.entries(__assign(__assign({\n      redirect_uri: redirectSignIn,\n      response_type: responseType,\n      client_id: clientId,\n      identity_provider: provider,\n      scope: scopesString,\n      state: state\n    }, responseType === 'code' ? {\n      code_challenge: code_challenge\n    } : {}), responseType === 'code' ? {\n      code_challenge_method: code_challenge_method\n    } : {})).map(function (_a) {\n      var _b = __read(_a, 2),\n        k = _b[0],\n        v = _b[1];\n      return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n    }).join('&');\n    var URL = \"https://\" + domain + \"/oauth2/authorize?\" + queryString;\n    logger.debug(\"Redirecting to \" + URL);\n    this._urlOpener(URL, redirectSignIn);\n  };\n  OAuth.prototype._handleCodeFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var code, currentUrlPathname, redirectSignInPathname, oAuthTokenEndpoint, client_id, redirect_uri, code_verifier, oAuthTokenBody, body, _a, access_token, refresh_token, id_token, error;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            code = (parse(currentUrl).query || '').split('&').map(function (pairings) {\n              return pairings.split('=');\n            }).reduce(function (accum, _a) {\n              var _b;\n              var _c = __read(_a, 2),\n                k = _c[0],\n                v = _c[1];\n              return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n            }, {\n              code: undefined\n            }).code;\n            currentUrlPathname = parse(currentUrl).pathname || '/';\n            redirectSignInPathname = parse(this._config.redirectSignIn).pathname || '/';\n            if (!code || currentUrlPathname !== redirectSignInPathname) {\n              return [2 /*return*/];\n            }\n\n            oAuthTokenEndpoint = 'https://' + this._config.domain + '/oauth2/token';\n            dispatchAuthEvent('codeFlow', {}, \"Retrieving tokens from \" + oAuthTokenEndpoint);\n            client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.clientID;\n            redirect_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignIn : this._config.redirectUri;\n            code_verifier = oAuthStorage.getPKCE();\n            oAuthTokenBody = __assign({\n              grant_type: 'authorization_code',\n              code: code,\n              client_id: client_id,\n              redirect_uri: redirect_uri\n            }, code_verifier ? {\n              code_verifier: code_verifier\n            } : {});\n            logger.debug(\"Calling token endpoint: \" + oAuthTokenEndpoint + \" with\", oAuthTokenBody);\n            body = Object.entries(oAuthTokenBody).map(function (_a) {\n              var _b = __read(_a, 2),\n                k = _b[0],\n                v = _b[1];\n              return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n            }).join('&');\n            return [4 /*yield*/, fetch(oAuthTokenEndpoint, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/x-www-form-urlencoded'\n              },\n              body: body\n            })];\n          case 1:\n            return [4 /*yield*/, _b.sent().json()];\n          case 2:\n            _a = _b.sent(), access_token = _a.access_token, refresh_token = _a.refresh_token, id_token = _a.id_token, error = _a.error;\n            if (error) {\n              throw new Error(error);\n            }\n            return [2 /*return*/, {\n              accessToken: access_token,\n              refreshToken: refresh_token,\n              idToken: id_token\n            }];\n        }\n      });\n    });\n  };\n  OAuth.prototype._handleImplicitFlow = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, id_token, access_token;\n      return __generator(this, function (_b) {\n        _a = (parse(currentUrl).hash || '#').substr(1) // Remove # from returned code\n        .split('&').map(function (pairings) {\n          return pairings.split('=');\n        }).reduce(function (accum, _a) {\n          var _b;\n          var _c = __read(_a, 2),\n            k = _c[0],\n            v = _c[1];\n          return __assign(__assign({}, accum), (_b = {}, _b[k] = v, _b));\n        }, {\n          id_token: undefined,\n          access_token: undefined\n        }), id_token = _a.id_token, access_token = _a.access_token;\n        dispatchAuthEvent('implicitFlow', {}, \"Got tokens from \" + currentUrl);\n        logger.debug(\"Retrieving implicit tokens from \" + currentUrl + \" with\");\n        return [2 /*return*/, {\n          accessToken: access_token,\n          idToken: id_token,\n          refreshToken: null\n        }];\n      });\n    });\n  };\n  OAuth.prototype.handleAuthResponse = function (currentUrl) {\n    return __awaiter(this, void 0, void 0, function () {\n      var urlParams, error, error_description, state, _a, _b, e_1;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _c.trys.push([0, 5,, 6]);\n            urlParams = currentUrl ? __assign(__assign({}, (parse(currentUrl).hash || '#').substr(1).split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                k = _b[0],\n                v = _b[1];\n              return acc[k] = v, acc;\n            }, {})), (parse(currentUrl).query || '').split('&').map(function (entry) {\n              return entry.split('=');\n            }).reduce(function (acc, _a) {\n              var _b = __read(_a, 2),\n                k = _b[0],\n                v = _b[1];\n              return acc[k] = v, acc;\n            }, {})) : {};\n            error = urlParams.error, error_description = urlParams.error_description;\n            if (error) {\n              throw new Error(error_description);\n            }\n            state = this._validateState(urlParams);\n            logger.debug(\"Starting \" + this._config.responseType + \" flow with \" + currentUrl);\n            if (!(this._config.responseType === 'code')) return [3 /*break*/, 2];\n            _a = [{}];\n            return [4 /*yield*/, this._handleCodeFlow(currentUrl)];\n          case 1:\n            return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _a.concat([_c.sent()])), {\n              state: state\n            }])];\n          case 2:\n            _b = [{}];\n            return [4 /*yield*/, this._handleImplicitFlow(currentUrl)];\n          case 3:\n            return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _b.concat([_c.sent()])), {\n              state: state\n            }])];\n          case 4:\n            return [3 /*break*/, 6];\n          case 5:\n            e_1 = _c.sent();\n            logger.error(\"Error handling auth response.\", e_1);\n            throw e_1;\n          case 6:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  OAuth.prototype._validateState = function (urlParams) {\n    if (!urlParams) {\n      return;\n    }\n    var savedState = oAuthStorage.getState();\n    var returnedState = urlParams.state;\n    // This is because savedState only exists if the flow was initiated by Amplify\n    if (savedState && savedState !== returnedState) {\n      throw new Error('Invalid state in OAuth flow');\n    }\n    return returnedState;\n  };\n  OAuth.prototype.signOut = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var oAuthLogoutEndpoint, client_id, signout_uri;\n      return __generator(this, function (_a) {\n        oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n        client_id = isCognitoHostedOpts(this._config) ? this._cognitoClientId : this._config.oauth.clientID;\n        signout_uri = isCognitoHostedOpts(this._config) ? this._config.redirectSignOut : this._config.returnTo;\n        oAuthLogoutEndpoint += Object.entries({\n          client_id: client_id,\n          logout_uri: encodeURIComponent(signout_uri)\n        }).map(function (_a) {\n          var _b = __read(_a, 2),\n            k = _b[0],\n            v = _b[1];\n          return k + \"=\" + v;\n        }).join('&');\n        dispatchAuthEvent('oAuthSignOut', {\n          oAuth: 'signOut'\n        }, \"Signing out from \" + oAuthLogoutEndpoint);\n        logger.debug(\"Signing out from \" + oAuthLogoutEndpoint);\n        return [2 /*return*/, this._urlOpener(oAuthLogoutEndpoint, signout_uri)];\n      });\n    });\n  };\n  OAuth.prototype._generateState = function (length) {\n    var result = '';\n    var i = length;\n    var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    for (; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n    return result;\n  };\n  OAuth.prototype._generateChallenge = function (code) {\n    var awsCryptoHash = new Sha256();\n    awsCryptoHash.update(code);\n    var resultFromAWSCrypto = awsCryptoHash.digestSync();\n    var b64 = Buffer.from(resultFromAWSCrypto).toString('base64');\n    var base64URLFromAWSCrypto = this._base64URL(b64);\n    return base64URLFromAWSCrypto;\n  };\n  OAuth.prototype._base64URL = function (string) {\n    return string.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n  };\n  OAuth.prototype._generateRandom = function (size) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n    var buffer = new Uint8Array(size);\n    if (typeof window !== 'undefined' && !!window.crypto) {\n      window.crypto.getRandomValues(buffer);\n    } else {\n      for (var i = 0; i < size; i += 1) {\n        buffer[i] = Math.random() * CHARSET.length | 0;\n      }\n    }\n    return this._bufferToString(buffer);\n  };\n  OAuth.prototype._bufferToString = function (buffer) {\n    var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    var state = [];\n    for (var i = 0; i < buffer.byteLength; i += 1) {\n      var index = buffer[i] % CHARSET.length;\n      state.push(CHARSET[index]);\n    }\n    return state.join('');\n  };\n  return OAuth;\n}();\nexport default OAuth;","map":{"version":3,"names":["__assign","__awaiter","__generator","__read","parse","launchUri","oAuthStorage","Buffer","isCognitoHostedOpts","CognitoHostedUIIdentityProvider","ConsoleLogger","Logger","Hub","urlSafeEncode","Sha256","AMPLIFY_SYMBOL","Symbol","for","dispatchAuthEvent","event","data","message","dispatch","logger","OAuth","_a","config","cognitoClientId","_b","scopes","_urlOpener","urlOpener","_config","_cognitoClientId","isValidScopes","Error","_scopes","prototype","Array","isArray","every","scope","oauthSignIn","responseType","domain","redirectSignIn","clientId","provider","customState","Cognito","generatedState","_generateState","state","setState","pkce_key","_generateRandom","setPKCE","code_challenge","_generateChallenge","code_challenge_method","scopesString","join","queryString","Object","entries","redirect_uri","response_type","client_id","identity_provider","map","k","v","encodeURIComponent","URL","debug","_handleCodeFlow","currentUrl","code","currentUrlPathname","redirectSignInPathname","oAuthTokenEndpoint","code_verifier","oAuthTokenBody","body","access_token","refresh_token","id_token","error","label","query","split","pairings","reduce","accum","_c","undefined","pathname","clientID","redirectUri","getPKCE","grant_type","fetch","method","headers","sent","json","accessToken","refreshToken","idToken","_handleImplicitFlow","hash","substr","handleAuthResponse","urlParams","error_description","e_1","trys","push","entry","acc","_validateState","apply","concat","savedState","getState","returnedState","signOut","oAuthLogoutEndpoint","signout_uri","oauth","redirectSignOut","returnTo","logout_uri","oAuth","length","result","i","chars","Math","round","random","awsCryptoHash","update","resultFromAWSCrypto","digestSync","b64","from","toString","base64URLFromAWSCrypto","_base64URL","string","replace","size","CHARSET","buffer","Uint8Array","window","crypto","getRandomValues","_bufferToString","byteLength","index"],"sources":["/Users/macbook/Documents/Chatapp/temp-repo-chatbot/frontend/node_modules/@aws-amplify/auth/lib-esm/OAuth/OAuth.js"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { __assign, __awaiter, __generator, __read } from \"tslib\";\nimport { parse } from 'url'; // Used for OAuth parsing of Cognito Hosted UI\nimport { launchUri } from './urlOpener';\nimport * as oAuthStorage from './oauthStorage';\nimport { Buffer } from 'buffer';\nimport { isCognitoHostedOpts, CognitoHostedUIIdentityProvider, } from '../types/Auth';\nimport { ConsoleLogger as Logger, Hub, urlSafeEncode } from '@aws-amplify/core';\nimport { Sha256 } from '@aws-crypto/sha256-js';\nvar AMPLIFY_SYMBOL = (typeof Symbol !== 'undefined' && typeof Symbol.for === 'function'\n    ? Symbol.for('amplify_default')\n    : '@@amplify_default');\nvar dispatchAuthEvent = function (event, data, message) {\n    Hub.dispatch('auth', { event: event, data: data, message: message }, 'Auth', AMPLIFY_SYMBOL);\n};\nvar logger = new Logger('OAuth');\nvar OAuth = /** @class */ (function () {\n    function OAuth(_a) {\n        var config = _a.config, cognitoClientId = _a.cognitoClientId, _b = _a.scopes, scopes = _b === void 0 ? [] : _b;\n        this._urlOpener = config.urlOpener || launchUri;\n        this._config = config;\n        this._cognitoClientId = cognitoClientId;\n        if (!this.isValidScopes(scopes))\n            throw Error('scopes must be a String Array');\n        this._scopes = scopes;\n    }\n    OAuth.prototype.isValidScopes = function (scopes) {\n        return (Array.isArray(scopes) && scopes.every(function (scope) { return typeof scope === 'string'; }));\n    };\n    OAuth.prototype.oauthSignIn = function (responseType, domain, redirectSignIn, clientId, provider, customState) {\n        if (responseType === void 0) { responseType = 'code'; }\n        if (provider === void 0) { provider = CognitoHostedUIIdentityProvider.Cognito; }\n        var generatedState = this._generateState(32);\n        /* encodeURIComponent is not URL safe, use urlSafeEncode instead. Cognito\n        single-encodes/decodes url on first sign in and double-encodes/decodes url\n        when user already signed in. Using encodeURIComponent, Base32, Base64 add\n        characters % or = which on further encoding becomes unsafe. '=' create issue\n        for parsing query params.\n        Refer: https://github.com/aws-amplify/amplify-js/issues/5218 */\n        var state = customState\n            ? generatedState + \"-\" + urlSafeEncode(customState)\n            : generatedState;\n        oAuthStorage.setState(state);\n        var pkce_key = this._generateRandom(128);\n        oAuthStorage.setPKCE(pkce_key);\n        var code_challenge = this._generateChallenge(pkce_key);\n        var code_challenge_method = 'S256';\n        var scopesString = this._scopes.join(' ');\n        var queryString = Object.entries(__assign(__assign({ redirect_uri: redirectSignIn, response_type: responseType, client_id: clientId, identity_provider: provider, scope: scopesString, state: state }, (responseType === 'code' ? { code_challenge: code_challenge } : {})), (responseType === 'code' ? { code_challenge_method: code_challenge_method } : {})))\n            .map(function (_a) {\n            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n            return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n        })\n            .join('&');\n        var URL = \"https://\" + domain + \"/oauth2/authorize?\" + queryString;\n        logger.debug(\"Redirecting to \" + URL);\n        this._urlOpener(URL, redirectSignIn);\n    };\n    OAuth.prototype._handleCodeFlow = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var code, currentUrlPathname, redirectSignInPathname, oAuthTokenEndpoint, client_id, redirect_uri, code_verifier, oAuthTokenBody, body, _a, access_token, refresh_token, id_token, error;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        code = (parse(currentUrl).query || '')\n                            .split('&')\n                            .map(function (pairings) { return pairings.split('='); })\n                            .reduce(function (accum, _a) {\n                            var _b;\n                            var _c = __read(_a, 2), k = _c[0], v = _c[1];\n                            return (__assign(__assign({}, accum), (_b = {}, _b[k] = v, _b)));\n                        }, { code: undefined }).code;\n                        currentUrlPathname = parse(currentUrl).pathname || '/';\n                        redirectSignInPathname = parse(this._config.redirectSignIn).pathname || '/';\n                        if (!code || currentUrlPathname !== redirectSignInPathname) {\n                            return [2 /*return*/];\n                        }\n                        oAuthTokenEndpoint = 'https://' + this._config.domain + '/oauth2/token';\n                        dispatchAuthEvent('codeFlow', {}, \"Retrieving tokens from \" + oAuthTokenEndpoint);\n                        client_id = isCognitoHostedOpts(this._config)\n                            ? this._cognitoClientId\n                            : this._config.clientID;\n                        redirect_uri = isCognitoHostedOpts(this._config)\n                            ? this._config.redirectSignIn\n                            : this._config.redirectUri;\n                        code_verifier = oAuthStorage.getPKCE();\n                        oAuthTokenBody = __assign({ grant_type: 'authorization_code', code: code,\n                            client_id: client_id,\n                            redirect_uri: redirect_uri }, (code_verifier ? { code_verifier: code_verifier } : {}));\n                        logger.debug(\"Calling token endpoint: \" + oAuthTokenEndpoint + \" with\", oAuthTokenBody);\n                        body = Object.entries(oAuthTokenBody)\n                            .map(function (_a) {\n                            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                            return encodeURIComponent(k) + \"=\" + encodeURIComponent(v);\n                        })\n                            .join('&');\n                        return [4 /*yield*/, fetch(oAuthTokenEndpoint, {\n                                method: 'POST',\n                                headers: {\n                                    'Content-Type': 'application/x-www-form-urlencoded',\n                                },\n                                body: body,\n                            })];\n                    case 1: return [4 /*yield*/, (_b.sent()).json()];\n                    case 2:\n                        _a = _b.sent(), access_token = _a.access_token, refresh_token = _a.refresh_token, id_token = _a.id_token, error = _a.error;\n                        if (error) {\n                            throw new Error(error);\n                        }\n                        return [2 /*return*/, {\n                                accessToken: access_token,\n                                refreshToken: refresh_token,\n                                idToken: id_token,\n                            }];\n                }\n            });\n        });\n    };\n    OAuth.prototype._handleImplicitFlow = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, id_token, access_token;\n            return __generator(this, function (_b) {\n                _a = (parse(currentUrl).hash || '#')\n                    .substr(1) // Remove # from returned code\n                    .split('&')\n                    .map(function (pairings) { return pairings.split('='); })\n                    .reduce(function (accum, _a) {\n                    var _b;\n                    var _c = __read(_a, 2), k = _c[0], v = _c[1];\n                    return (__assign(__assign({}, accum), (_b = {}, _b[k] = v, _b)));\n                }, {\n                    id_token: undefined,\n                    access_token: undefined,\n                }), id_token = _a.id_token, access_token = _a.access_token;\n                dispatchAuthEvent('implicitFlow', {}, \"Got tokens from \" + currentUrl);\n                logger.debug(\"Retrieving implicit tokens from \" + currentUrl + \" with\");\n                return [2 /*return*/, {\n                        accessToken: access_token,\n                        idToken: id_token,\n                        refreshToken: null,\n                    }];\n            });\n        });\n    };\n    OAuth.prototype.handleAuthResponse = function (currentUrl) {\n        return __awaiter(this, void 0, void 0, function () {\n            var urlParams, error, error_description, state, _a, _b, e_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        urlParams = currentUrl\n                            ? __assign(__assign({}, (parse(currentUrl).hash || '#')\n                                .substr(1)\n                                .split('&')\n                                .map(function (entry) { return entry.split('='); })\n                                .reduce(function (acc, _a) {\n                                var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                                return ((acc[k] = v), acc);\n                            }, {})), (parse(currentUrl).query || '')\n                                .split('&')\n                                .map(function (entry) { return entry.split('='); })\n                                .reduce(function (acc, _a) {\n                                var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                                return ((acc[k] = v), acc);\n                            }, {}))\n                            : {};\n                        error = urlParams.error, error_description = urlParams.error_description;\n                        if (error) {\n                            throw new Error(error_description);\n                        }\n                        state = this._validateState(urlParams);\n                        logger.debug(\"Starting \" + this._config.responseType + \" flow with \" + currentUrl);\n                        if (!(this._config.responseType === 'code')) return [3 /*break*/, 2];\n                        _a = [{}];\n                        return [4 /*yield*/, this._handleCodeFlow(currentUrl)];\n                    case 1: return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _a.concat([(_c.sent())])), { state: state }])];\n                    case 2:\n                        _b = [{}];\n                        return [4 /*yield*/, this._handleImplicitFlow(currentUrl)];\n                    case 3: return [2 /*return*/, __assign.apply(void 0, [__assign.apply(void 0, _b.concat([(_c.sent())])), { state: state }])];\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        e_1 = _c.sent();\n                        logger.error(\"Error handling auth response.\", e_1);\n                        throw e_1;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    OAuth.prototype._validateState = function (urlParams) {\n        if (!urlParams) {\n            return;\n        }\n        var savedState = oAuthStorage.getState();\n        var returnedState = urlParams.state;\n        // This is because savedState only exists if the flow was initiated by Amplify\n        if (savedState && savedState !== returnedState) {\n            throw new Error('Invalid state in OAuth flow');\n        }\n        return returnedState;\n    };\n    OAuth.prototype.signOut = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var oAuthLogoutEndpoint, client_id, signout_uri;\n            return __generator(this, function (_a) {\n                oAuthLogoutEndpoint = 'https://' + this._config.domain + '/logout?';\n                client_id = isCognitoHostedOpts(this._config)\n                    ? this._cognitoClientId\n                    : this._config.oauth.clientID;\n                signout_uri = isCognitoHostedOpts(this._config)\n                    ? this._config.redirectSignOut\n                    : this._config.returnTo;\n                oAuthLogoutEndpoint += Object.entries({\n                    client_id: client_id,\n                    logout_uri: encodeURIComponent(signout_uri),\n                })\n                    .map(function (_a) {\n                    var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                    return k + \"=\" + v;\n                })\n                    .join('&');\n                dispatchAuthEvent('oAuthSignOut', { oAuth: 'signOut' }, \"Signing out from \" + oAuthLogoutEndpoint);\n                logger.debug(\"Signing out from \" + oAuthLogoutEndpoint);\n                return [2 /*return*/, this._urlOpener(oAuthLogoutEndpoint, signout_uri)];\n            });\n        });\n    };\n    OAuth.prototype._generateState = function (length) {\n        var result = '';\n        var i = length;\n        var chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n        for (; i > 0; --i)\n            result += chars[Math.round(Math.random() * (chars.length - 1))];\n        return result;\n    };\n    OAuth.prototype._generateChallenge = function (code) {\n        var awsCryptoHash = new Sha256();\n        awsCryptoHash.update(code);\n        var resultFromAWSCrypto = awsCryptoHash.digestSync();\n        var b64 = Buffer.from(resultFromAWSCrypto).toString('base64');\n        var base64URLFromAWSCrypto = this._base64URL(b64);\n        return base64URLFromAWSCrypto;\n    };\n    OAuth.prototype._base64URL = function (string) {\n        return string.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    };\n    OAuth.prototype._generateRandom = function (size) {\n        var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';\n        var buffer = new Uint8Array(size);\n        if (typeof window !== 'undefined' && !!window.crypto) {\n            window.crypto.getRandomValues(buffer);\n        }\n        else {\n            for (var i = 0; i < size; i += 1) {\n                buffer[i] = (Math.random() * CHARSET.length) | 0;\n            }\n        }\n        return this._bufferToString(buffer);\n    };\n    OAuth.prototype._bufferToString = function (buffer) {\n        var CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n        var state = [];\n        for (var i = 0; i < buffer.byteLength; i += 1) {\n            var index = buffer[i] % CHARSET.length;\n            state.push(CHARSET[index]);\n        }\n        return state.join('');\n    };\n    return OAuth;\n}());\nexport default OAuth;\n//# sourceMappingURL=OAuth.js.map"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}