{"ast":null,"code":"var _jsxFileName = \"/Users/macbook/Documents/projet ipssi/temp-repo-chatbot/frontend/src/App.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s5 = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport './App.css';\n\n// Amplify\nimport { Amplify, API } from \"aws-amplify\";\nimport { Box, Button, Container, FormControlLabel, Grid, IconButton, List, ListItem, ListItemText, Paper, Switch, TextField, Typography } from '@mui/material';\n\n// Material ui icons\nimport CloudUploadIcon from \"@mui/icons-material/CloudUpload\";\nimport FiberManualRecordIcon from '@mui/icons-material/FiberManualRecord';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicRecorder from 'mic-recorder-to-mp3';\nimport MoreHorizIcon from '@mui/icons-material/MoreHoriz';\nimport SendIcon from \"@mui/icons-material/Send\";\nimport VolumeUpIcon from '@mui/icons-material/VolumeUp';\nimport { useTheme } from '@mui/material/styles';\nimport { keyframes, styled } from '@mui/system';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst AudioControls = _ref => {\n  _s();\n  let {\n    isAudioResponse,\n    filterMessageObjects,\n    messages,\n    setMessages,\n    handleBackendResponse\n  } = _ref;\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n  const [player, setPlayer] = useState(null);\n  const [audioFile, setAudioFile] = useState(null);\n  const startRecording = async () => {\n    const newRecorder = new MicRecorder({\n      bitRate: 128\n    });\n    try {\n      await newRecorder.start();\n      setIsRecording(true);\n      setRecorder(newRecorder);\n    } catch (e) {\n      console.error(e);\n      alert(e);\n    }\n  };\n  const stopRecording = async () => {\n    if (!recorder) return;\n    try {\n      const [buffer, blob] = await recorder.stop().getMp3();\n      const audioFile = new File(buffer, \"voice-message.mp3\", {\n        type: blob.type,\n        lastModified: Date.now()\n      });\n      setPlayer(new Audio(URL.createObjectURL(audioFile)));\n      setIsRecording(false);\n      setAudioFile(audioFile); // Add this line\n    } catch (e) {\n      console.error(e);\n      alert(e);\n    }\n  };\n  const playRecording = () => {\n    if (player) {\n      player.play();\n    }\n  };\n  Amplify.configure({\n    // OPTIONAL - if your API requires authentication \n    Auth: {\n      mandatorySignIn: false\n    },\n    API: {\n      endpoints: [{\n        name: \"api\",\n        endpoint: \"https://cmao5s9ach.execute-api.eu-west-3.amazonaws.com/dev\"\n      }]\n    }\n  });\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        width: \"100%\",\n        mt: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 2,\n        justifyContent: \"flex-end\",\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: true,\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            color: \"primary\",\n            \"aria-label\": \"start recording\",\n            onClick: startRecording,\n            disabled: isRecording,\n            children: /*#__PURE__*/_jsxDEV(MicIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: true,\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            color: \"secondary\",\n            \"aria-label\": \"stop recording\",\n            onClick: stopRecording,\n            disabled: !isRecording,\n            children: /*#__PURE__*/_jsxDEV(FiberManualRecordIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: \"auto\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            disableElevation: true,\n            onClick: playRecording,\n            disabled: isRecording,\n            children: \"Play Recording\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SendButton, {\n          audioFile: audioFile,\n          isAudioResponse: isAudioResponse,\n          filterMessageObjects: filterMessageObjects,\n          messages: messages,\n          handleBackendResponse: handleBackendResponse,\n          setMessages: setMessages\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n};\n_s(AudioControls, \"utKXYMMlZQyGA/kfW/ReVwrC1RE=\");\n_c = AudioControls;\nconst ResponseFormatToggle = _ref2 => {\n  let {\n    isAudioResponse,\n    setIsAudioResponse\n  } = _ref2;\n  const handleToggleChange = event => {\n    setIsAudioResponse(event.target.checked);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      marginTop: 2\n    },\n    children: /*#__PURE__*/_jsxDEV(FormControlLabel, {\n      control: /*#__PURE__*/_jsxDEV(Switch, {\n        checked: isAudioResponse,\n        onChange: handleToggleChange,\n        color: \"primary\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }, this),\n      label: \"Audio response\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 5\n  }, this);\n};\n_c2 = ResponseFormatToggle;\nconst pulse = keyframes`\n0% {\n  transform: scale(1);\n  opacity: 1;\n}\n50% {\n  transform: scale(1.1);\n  opacity: 0.7;\n}\n100% {\n  transform: scale(1);\n  opacity: 1;\n}\n`;\nconst ThinkingBubbleStyled = styled(MoreHorizIcon)`\n  animation: ${pulse} 1.2s ease-in-out infinite;\n  margin-bottom: -5px;\n`;\n_c3 = ThinkingBubbleStyled;\nconst ThinkingBubble = () => {\n  _s2();\n  const theme = useTheme();\n  return /*#__PURE__*/_jsxDEV(ThinkingBubbleStyled, {\n    theme: theme,\n    sx: {\n      marginBottom: '-5px'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 191,\n    columnNumber: 10\n  }, this);\n};\n_s2(ThinkingBubble, \"VrMvFCCB9Haniz3VCRPNUiCauHs=\", false, function () {\n  return [useTheme];\n});\n_c4 = ThinkingBubble;\nconst SendButton = _ref3 => {\n  _s3();\n  let {\n    audioFile,\n    isAudioResponse,\n    filterMessageObjects,\n    messages,\n    setMessages,\n    handleBackendResponse\n  } = _ref3;\n  const theme = useTheme();\n  const uploadAudio = async () => {\n    if (!audioFile) {\n      console.log(\"No audio file to upload\");\n      return;\n    }\n    try {\n      const reader = new FileReader();\n      reader.onloadend = async () => {\n        try {\n          const base64Audio = reader.result;\n\n          // Add a unique id to the message to be able to uptade it later\n          const messageId = new Date().getTime();\n\n          // Create the message objects\n          let messageObjects = filterMessageObjects(messages);\n\n          // Add user's audio message to the messages array\n          setMessages(prevMessages => [...prevMessages, {\n            role: \"user\",\n            content: \"ðŸŽ¤ Audio Message\",\n            audio: new Audio(base64Audio),\n            text: \"ðŸŽ¤ Audio Message\",\n            id: messageId\n          }]);\n\n          // Add thinking bubble\n          setMessages(prevMessages => [...prevMessages, {\n            role: \"assistant\",\n            content: /*#__PURE__*/_jsxDEV(ThinkingBubble, {\n              theme: theme,\n              sx: {\n                marginBottom: '-5px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 43\n            }, this),\n            text: /*#__PURE__*/_jsxDEV(ThinkingBubble, {\n              theme: theme,\n              sx: {\n                marginBottom: '-5px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 113\n            }, this),\n            key: \"thinking\"\n          }]);\n          const response = await API.post(\"api\", \"/get-answer\", {\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: {\n              audio: base64Audio,\n              messages: messageObjects,\n              isAudioResponse\n            }\n          });\n          handleBackendResponse(response, messageId);\n        } catch (error) {\n          console.error(\"Error uploading audio file:\", error);\n          alert(`Error uploading audio file: ${error.message || error}`);\n        } finally {\n          // Remove the thinking bubble\n          setMessages(prevMessages => {\n            return prevMessages.filter(message => message.key !== \"thinking\");\n          });\n        }\n      };\n      reader.readAsDataURL(audioFile);\n    } catch (error) {\n      console.error(\"Error uploading audio file:\", error);\n      alert(error);\n    }\n\n    // Remove the thinking bubble\n    setMessages(prevMessages => {\n      return prevMessages.filter(message => message.key !== \"thinking\");\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    item: true,\n    xs: \"auto\",\n    children: /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      disableElevation: true,\n      onClick: uploadAudio,\n      disabled: !audioFile,\n      startIcon: /*#__PURE__*/_jsxDEV(CloudUploadIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 20\n      }, this),\n      children: \"Upload Audio\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 270,\n    columnNumber: 5\n  }, this);\n};\n_s3(SendButton, \"VrMvFCCB9Haniz3VCRPNUiCauHs=\", false, function () {\n  return [useTheme];\n});\n_c5 = SendButton;\nconst MessageInput = _ref4 => {\n  let {\n    message,\n    setMessage,\n    isAudioResponse,\n    handleSendMessage\n  } = _ref4;\n  const handleInputChange = event => {\n    setMessage(event.target.value);\n  };\n  const handleKeyPress = event => {\n    if (event.key === \"Enter\") {\n      handleSendMessage();\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      display: \"flex\",\n      alignItems: \"center\",\n      marginTop: 2\n    },\n    children: [/*#__PURE__*/_jsxDEV(TextField, {\n      variant: \"outlined\",\n      fullWidth: true,\n      label: \"Type your message\",\n      value: message,\n      onChange: handleInputChange,\n      onKeyPress: handleKeyPress\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n      color: \"primary\",\n      onClick: () => handleSendMessage(isAudioResponse),\n      disabled: message.trim() === \"\",\n      children: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 299,\n    columnNumber: 5\n  }, this);\n};\n_c6 = MessageInput;\nfunction App() {\n  _s5();\n  var _s4 = $RefreshSig$(),\n    _this = this;\n  const mockMessages = [{\n    role: 'assistant',\n    content: 'Hello, how can I help you today?',\n    text: 'Hello, how can I help you today?'\n  }];\n  const [isAudioResponse, setIsAudioResponse] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState(mockMessages);\n  const theme = useTheme();\n  const ChatHeader = () => {\n    return /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h4\",\n      align: \"center\",\n      gutterBottom: true,\n      children: \"Voice Chatbot\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 7\n    }, this);\n  };\n  const UserMessage = styled('div', {\n    shouldForwardProp: prop => prop !== 'audio'\n  })`\n  position: relative;\n  background-color: ${_ref5 => {\n    let {\n      theme\n    } = _ref5;\n    return theme.palette.primary.main;\n  }};\n  color: ${_ref6 => {\n    let {\n      theme\n    } = _ref6;\n    return theme.palette.primary.contrastText;\n  }};\n  padding: ${_ref7 => {\n    let {\n      theme\n    } = _ref7;\n    return theme.spacing(1, 2);\n  }};\n  padding-right: ${_ref8 => {\n    let {\n      theme,\n      audio\n    } = _ref8;\n    return audio ? theme.spacing(6) : theme.spacing(2);\n  }};\n  border-radius: 1rem;\n  border-top-right-radius: 0;\n  align-self: flex-end;\n  max-width: 80%;\n  word-wrap: break-word;\n`;\n  const AgentMessage = styled('div')`\nposition: relative;\nbackground-color: ${_ref9 => {\n    let {\n      theme\n    } = _ref9;\n    return theme.palette.grey[300];\n  }};\ncolor: ${_ref10 => {\n    let {\n      theme\n    } = _ref10;\n    return theme.palette.text.primary;\n  }};\npadding: ${_ref11 => {\n    let {\n      theme\n    } = _ref11;\n    return theme.spacing(1, 2);\n  }};\nborder-radius: 1rem;\nborder-top-left-radius: 0;\nalign-self: flex-end;\nmax-width: 80%;\nword-wrap: break-word;\n`;\n  const MessageWrapper = styled('div')`\ndisplay: flex;\nmargin-bottom: ${_ref12 => {\n    let {\n      theme\n    } = _ref12;\n    return theme.spacing(1);\n  }};\njustify-content: ${_ref13 => {\n    let {\n      align\n    } = _ref13;\n    return align === 'user' ? 'flex-end' : 'flex-start';\n  }};\n`;\n  const ChatMessages = _ref14 => {\n    _s4();\n    let {\n      messages\n    } = _ref14;\n    const theme = useTheme();\n    const bottomRef = useRef(null);\n    const scrollToBottom = () => {\n      if (bottomRef.current) {\n        if (typeof bottomRef.current.scrollIntoViewIfNeeded === 'function') {\n          bottomRef.current.scrollIntoViewIfNeeded({\n            behavior: 'smooth'\n          });\n        } else {\n          bottomRef.current.scrollIntoView({\n            behavior: 'smooth'\n          });\n        }\n      }\n    };\n\n    // Hook that scrolls the chat to the bottom whenever the messages prop changes\n    useEffect(() => {\n      scrollToBottom();\n    }, [messages]);\n    return /*#__PURE__*/_jsxDEV(Container, {\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          width: '100%',\n          mt: 4,\n          maxHeight: 300,\n          minHeight: 300,\n          overflow: 'auto'\n        },\n        children: /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 0,\n          sx: {\n            padding: 2\n          },\n          children: /*#__PURE__*/_jsxDEV(List, {\n            children: [messages.map((message, index) => /*#__PURE__*/_jsxDEV(ListItem, {\n              sx: {\n                padding: 0\n              },\n              children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                sx: {\n                  margin: 0\n                },\n                primary: /*#__PURE__*/_jsxDEV(MessageWrapper, {\n                  align: message.role,\n                  children: message.role === 'user' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: /*#__PURE__*/_jsxDEV(UserMessage, {\n                      theme: theme,\n                      audio: message.audio,\n                      children: [message.text, message.audio && /*#__PURE__*/_jsxDEV(IconButton, {\n                        size: \"small\",\n                        sx: {\n                          position: 'absolute',\n                          top: '50%',\n                          right: 8,\n                          transform: 'translateY(-50%)'\n                        },\n                        onClick: () => message.audio.play(),\n                        children: /*#__PURE__*/_jsxDEV(VolumeUpIcon, {\n                          fontSize: \"small\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 425,\n                          columnNumber: 35\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 415,\n                        columnNumber: 33\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 412,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false) : /*#__PURE__*/_jsxDEV(AgentMessage, {\n                    theme: theme,\n                    children: message.text\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 431,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 409,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 19\n              }, this)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 17\n            }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: bottomRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 440,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 402,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 7\n    }, this);\n  };\n  _s4(ChatMessages, \"wRvUbyc9Rc4iriGdvpgZlT9Hxk4=\", false, function () {\n    return [useTheme];\n  });\n  function filterMessageObjects(list) {\n    return list.map(_ref15 => {\n      let {\n        role,\n        content\n      } = _ref15;\n      return {\n        role,\n        content\n      };\n    });\n  }\n  const handleSendMessage = async () => {\n    if (message.trim() !== \"\") {\n      // Send the message to the chat\n\n      // Add the new message to the chat area\n      setMessages(prevMessages => [...prevMessages, {\n        role: \"user\",\n        content: message,\n        text: message,\n        audio: null\n      }]);\n\n      // Clear the input field\n      setMessage(\"\");\n\n      // Add thinking bubble\n      setMessages(prevMessages => [...prevMessages, {\n        role: \"assistant\",\n        content: /*#__PURE__*/_jsxDEV(ThinkingBubble, {\n          theme: theme,\n          sx: {\n            marginBottom: '-5px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 39\n        }, this),\n        text: /*#__PURE__*/_jsxDEV(ThinkingBubble, {\n          theme: theme,\n          sx: {\n            marginBottom: '-5px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 109\n        }, this),\n        key: \"thinking\"\n      }]);\n\n      // Create backend chat input\n      let messageObjects = filterMessageObjects(messages);\n      messageObjects.push({\n        role: \"user\",\n        content: message\n      });\n\n      // Create endpoint for just getting the completion\n      try {\n        // Send the text message to the backend\n        const response = await API.post(\"api\", \"/get-answer\", {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: {\n            text: message,\n            messages: messageObjects,\n            isAudioResponse\n          }\n        });\n        handleBackendResponse(response); // Add function call\n      } catch (error) {\n        console.error(\"Error sending text message:\", error);\n        alert(error);\n      }\n\n      // Remove the thinking bubble\n      setMessages(prevMessages => {\n        return prevMessages.filter(message => message.key !== \"thinking\");\n      });\n    }\n  };\n  const handleBackendResponse = function (response) {\n    let id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    const generatedText = response.generated_text;\n    const generatedAudio = response.generated_audio;\n    const transcription = response.transcription;\n    const audioElement = generatedAudio ? new Audio(`data:audio/mpeg;base64,${generatedAudio}`) : null;\n    const AudioMessage = () => /*#__PURE__*/_jsxDEV(\"span\", {\n      children: [generatedText, \" \", audioElement && /*#__PURE__*/_jsxDEV(IconButton, {\n        \"aria-label\": \"play-message\",\n        onClick: () => {\n          audioElement.play();\n        },\n        children: /*#__PURE__*/_jsxDEV(VolumeUpIcon, {\n          style: {\n            cursor: \"pointer\"\n          },\n          fontSize: \"small\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 13\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 7\n    }, _this);\n    if (id) {\n      setMessages(prevMessages => {\n        const updatedMessages = prevMessages.map(message => {\n          if (message.id && message.id === id) {\n            return {\n              ...message,\n              content: transcription\n            };\n          }\n          return message;\n        });\n        return [...updatedMessages, {\n          role: \"assistant\",\n          content: generatedText,\n          audio: audioElement,\n          text: /*#__PURE__*/_jsxDEV(AudioMessage, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 554,\n            columnNumber: 19\n          }, _this)\n        }];\n      });\n    } else {\n      // Simply add the response when no messageId is involved\n      setMessages(prevMessages => [...prevMessages, {\n        role: \"assistant\",\n        content: generatedText,\n        audio: audioElement,\n        text: /*#__PURE__*/_jsxDEV(AudioMessage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 566,\n          columnNumber: 17\n        }, _this)\n      }]);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"sm\",\n    sx: {\n      pt: 2\n    },\n    children: [/*#__PURE__*/_jsxDEV(ChatHeader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatMessages, {\n      messages: messages\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 577,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AudioControls, {\n      isAudioResponse: isAudioResponse,\n      filterMessageObjects: filterMessageObjects,\n      messages: messages,\n      setMessages: setMessages,\n      handleBackendResponse: handleBackendResponse\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n      message: message,\n      setMessage: setMessage,\n      isAudioResponse: isAudioResponse,\n      handleSendMessage: handleSendMessage,\n      handleBackendResponse: handleBackendResponse\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 579,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ResponseFormatToggle, {\n      isAudioResponse: isAudioResponse,\n      setIsAudioResponse: setIsAudioResponse\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 580,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 575,\n    columnNumber: 5\n  }, this);\n}\n_s5(App, \"be6sC46xMo6WX2MsMutBYIWIAPE=\", false, function () {\n  return [useTheme];\n});\n_c7 = App;\nexport default App;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"AudioControls\");\n$RefreshReg$(_c2, \"ResponseFormatToggle\");\n$RefreshReg$(_c3, \"ThinkingBubbleStyled\");\n$RefreshReg$(_c4, \"ThinkingBubble\");\n$RefreshReg$(_c5, \"SendButton\");\n$RefreshReg$(_c6, \"MessageInput\");\n$RefreshReg$(_c7, \"App\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Amplify","API","Box","Button","Container","FormControlLabel","Grid","IconButton","List","ListItem","ListItemText","Paper","Switch","TextField","Typography","CloudUploadIcon","FiberManualRecordIcon","MicIcon","MicRecorder","MoreHorizIcon","SendIcon","VolumeUpIcon","useTheme","keyframes","styled","jsxDEV","_jsxDEV","Fragment","_Fragment","AudioControls","_ref","_s","isAudioResponse","filterMessageObjects","messages","setMessages","handleBackendResponse","isRecording","setIsRecording","recorder","setRecorder","player","setPlayer","audioFile","setAudioFile","startRecording","newRecorder","bitRate","start","e","console","error","alert","stopRecording","buffer","blob","stop","getMp3","File","type","lastModified","Date","now","Audio","URL","createObjectURL","playRecording","play","configure","Auth","mandatorySignIn","endpoints","name","endpoint","children","sx","width","mt","container","spacing","justifyContent","item","xs","md","color","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","variant","disableElevation","SendButton","_c","ResponseFormatToggle","_ref2","setIsAudioResponse","handleToggleChange","event","target","checked","display","marginTop","control","onChange","label","_c2","pulse","ThinkingBubbleStyled","_c3","ThinkingBubble","_s2","theme","marginBottom","_c4","_ref3","_s3","uploadAudio","log","reader","FileReader","onloadend","base64Audio","result","messageId","getTime","messageObjects","prevMessages","role","content","audio","text","id","key","response","post","headers","body","message","filter","readAsDataURL","startIcon","_c5","MessageInput","_ref4","setMessage","handleSendMessage","handleInputChange","value","handleKeyPress","alignItems","fullWidth","onKeyPress","trim","_c6","App","_s5","_s4","$RefreshSig$","_this","mockMessages","ChatHeader","align","gutterBottom","UserMessage","shouldForwardProp","prop","_ref5","palette","primary","main","_ref6","contrastText","_ref7","_ref8","AgentMessage","_ref9","grey","_ref10","_ref11","MessageWrapper","_ref12","_ref13","ChatMessages","_ref14","bottomRef","scrollToBottom","current","scrollIntoViewIfNeeded","behavior","scrollIntoView","maxHeight","minHeight","overflow","elevation","padding","map","index","margin","size","position","top","right","transform","fontSize","ref","list","_ref15","push","arguments","length","undefined","generatedText","generated_text","generatedAudio","generated_audio","transcription","audioElement","AudioMessage","style","cursor","updatedMessages","maxWidth","pt","_c7","$RefreshReg$"],"sources":["/Users/macbook/Documents/projet ipssi/temp-repo-chatbot/frontend/src/App.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport './App.css';\n\n// Amplify\nimport { Amplify, API } from \"aws-amplify\";\n\nimport {\n  Box,\n  Button,\n  Container,\n  FormControlLabel,\n  Grid,\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Paper,\n  Switch,\n  TextField,\n  Typography\n} from '@mui/material';\n\n// Material ui icons\nimport CloudUploadIcon from \"@mui/icons-material/CloudUpload\";\nimport FiberManualRecordIcon from '@mui/icons-material/FiberManualRecord';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicRecorder from 'mic-recorder-to-mp3';\nimport MoreHorizIcon from '@mui/icons-material/MoreHoriz';\nimport SendIcon from \"@mui/icons-material/Send\";\nimport VolumeUpIcon from '@mui/icons-material/VolumeUp';\n\nimport { useTheme } from '@mui/material/styles';\nimport { keyframes, styled } from '@mui/system';\n\n\nconst AudioControls = ({ isAudioResponse, filterMessageObjects, messages, setMessages, handleBackendResponse }) => {\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n  const [player, setPlayer] = useState(null);\n  const [audioFile, setAudioFile] = useState(null);\n\n\n  const startRecording = async () => {\n    const newRecorder = new MicRecorder({ bitRate: 128 });\n\n    try {\n      await newRecorder.start();\n      setIsRecording(true);\n      setRecorder(newRecorder);\n    } catch (e) {\n      console.error(e);\n      alert(e)\n    }\n  };\n\n\n  const stopRecording = async () => {\n    if (!recorder) return;\n\n    try {\n      const [buffer, blob] = await recorder.stop().getMp3();\n      const audioFile = new File(buffer, \"voice-message.mp3\", {\n        type: blob.type,\n        lastModified: Date.now(),\n      });\n      setPlayer(new Audio(URL.createObjectURL(audioFile)));\n      setIsRecording(false);\n      setAudioFile(audioFile); // Add this line\n    } catch (e) {\n      console.error(e);\n      alert(e)\n    }\n  };\n\n\n  const playRecording = () => {\n    if (player) {\n      player.play();\n    }\n  };\n\n  Amplify.configure({\n    // OPTIONAL - if your API requires authentication \n    Auth: {\n      mandatorySignIn: false,\n    },\n    API: {\n      endpoints: [\n        {\n          name: \"api\",\n          endpoint: \"https://cmao5s9ach.execute-api.eu-west-3.amazonaws.com/dev\"\n        }\n      ]\n    }\n  });\n\n\n  return (\n    <Container>\n      <Box sx={{ width: \"100%\", mt: 4 }}>\n        <Grid container spacing={2} justifyContent=\"flex-end\">\n          <Grid item xs={12} md>\n            <IconButton\n              color=\"primary\"\n              aria-label=\"start recording\"\n              onClick={startRecording}\n              disabled={isRecording}\n            >\n              <MicIcon />\n            </IconButton>\n          </Grid>\n          <Grid item xs={12} md>\n            <IconButton\n              color=\"secondary\"\n              aria-label=\"stop recording\"\n              onClick={stopRecording}\n              disabled={!isRecording}\n            >\n              <FiberManualRecordIcon />\n            </IconButton>\n          </Grid>\n          <Grid item xs=\"auto\">\n            <Button\n              variant=\"contained\"\n              disableElevation\n              onClick={playRecording}\n              disabled={isRecording}\n            >\n              Play Recording\n            </Button>\n          </Grid>\n          <SendButton audioFile={audioFile} isAudioResponse={isAudioResponse} filterMessageObjects={filterMessageObjects}\n            messages={messages} handleBackendResponse={handleBackendResponse}\n            setMessages={setMessages} />\n        </Grid>\n      </Box>\n    </Container>\n  )\n\n}\n\n\nconst ResponseFormatToggle = ({ isAudioResponse, setIsAudioResponse }) => {\n\n\n  const handleToggleChange = (event) => {\n    setIsAudioResponse(event.target.checked);\n  };\n\n  return (\n    <Box sx={{ display: \"flex\", justifyContent: \"center\", marginTop: 2 }}>\n      <FormControlLabel\n        control={\n          <Switch\n            checked={isAudioResponse}\n            onChange={handleToggleChange}\n            color=\"primary\"\n          />\n        }\n        label=\"Audio response\"\n      />\n    </Box>\n  );\n}\n\n\nconst pulse = keyframes`\n0% {\n  transform: scale(1);\n  opacity: 1;\n}\n50% {\n  transform: scale(1.1);\n  opacity: 0.7;\n}\n100% {\n  transform: scale(1);\n  opacity: 1;\n}\n`;\n\n\nconst ThinkingBubbleStyled = styled(MoreHorizIcon)`\n  animation: ${pulse} 1.2s ease-in-out infinite;\n  margin-bottom: -5px;\n`;\n\n\nconst ThinkingBubble = () => {\n  const theme = useTheme();\n  return <ThinkingBubbleStyled theme={theme} sx={{ marginBottom: '-5px' }} />;\n};\n\n\nconst SendButton = ({ audioFile, isAudioResponse, filterMessageObjects, messages,\n  setMessages, handleBackendResponse }) => {\n  const theme = useTheme();\n\n  const uploadAudio = async () => {\n\n\n    if (!audioFile) {\n      console.log(\"No audio file to upload\");\n      return;\n    }\n\n    try {\n\n      const reader = new FileReader();\n      reader.onloadend = async () => {\n\n        try {\n          const base64Audio = reader.result;\n\n          // Add a unique id to the message to be able to uptade it later\n          const messageId = new Date().getTime();\n\n          // Create the message objects\n          let messageObjects = filterMessageObjects(messages)\n\n          // Add user's audio message to the messages array\n          setMessages((prevMessages) => [\n            ...prevMessages,\n            { role: \"user\", content: \"ðŸŽ¤ Audio Message\", audio: new Audio(base64Audio), text: \"ðŸŽ¤ Audio Message\", id: messageId },\n          ]);\n\n          // Add thinking bubble\n          setMessages((prevMessages) => [\n            ...prevMessages,\n            { role: \"assistant\", content: <ThinkingBubble theme={theme} sx={{ marginBottom: '-5px' }} />, text: <ThinkingBubble theme={theme} sx={{ marginBottom: '-5px' }} />, key: \"thinking\" },\n          ]);\n\n          const response = await API.post(\"api\", \"/get-answer\", {\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: {\n              audio: base64Audio,\n              messages: messageObjects,\n              isAudioResponse\n            },\n          });\n\n          handleBackendResponse(response, messageId);\n        } catch (error) {\n          console.error(\"Error uploading audio file:\", error);\n          alert(`Error uploading audio file: ${error.message || error}`);\n        }\n        finally {\n          // Remove the thinking bubble\n          setMessages((prevMessages) => {\n            return prevMessages.filter((message) => message.key !== \"thinking\");\n          });\n        }\n      };\n      reader.readAsDataURL(audioFile);\n\n    } catch (error) {\n      console.error(\"Error uploading audio file:\", error);\n      alert(error)\n    }\n\n    // Remove the thinking bubble\n    setMessages((prevMessages) => {\n      return prevMessages.filter((message) => message.key !== \"thinking\");\n    });\n  };\n\n  return (\n    <Grid item xs=\"auto\">\n      <Button\n        variant=\"contained\"\n        color=\"primary\"\n        disableElevation\n        onClick={uploadAudio}\n        disabled={!audioFile}\n        startIcon={<CloudUploadIcon />}\n      >\n        Upload Audio\n      </Button>\n    </Grid>\n  );\n\n}\n\nconst MessageInput = ({ message, setMessage, isAudioResponse, handleSendMessage }) => {\n\n  const handleInputChange = (event) => {\n    setMessage(event.target.value);\n  };\n\n  const handleKeyPress = (event) => {\n    if (event.key === \"Enter\") {\n      handleSendMessage();\n    }\n  };\n\n  return (\n    <Box sx={{ display: \"flex\", alignItems: \"center\", marginTop: 2 }}>\n      <TextField\n        variant=\"outlined\"\n        fullWidth\n        label=\"Type your message\"\n        value={message}\n        onChange={handleInputChange}\n        onKeyPress={handleKeyPress}\n      />\n      <IconButton\n        color=\"primary\"\n        onClick={() => handleSendMessage(isAudioResponse)}\n        disabled={message.trim() === \"\"}\n      >\n        <SendIcon />\n      </IconButton>\n    </Box>\n  );\n\n\n\n}\n\nfunction App() {\n\n  const mockMessages = [\n    {\n      role: 'assistant',\n      content: 'Hello, how can I help you today?',\n      text: 'Hello, how can I help you today?'\n    },\n  ];\n\n  const [isAudioResponse, setIsAudioResponse] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState(mockMessages);\n  const theme = useTheme();\n\n  const ChatHeader = () => {\n    return (\n      <Typography variant=\"h4\" align=\"center\" gutterBottom>\n        Voice Chatbot\n      </Typography>\n    )\n  }\n\n\n  const UserMessage = styled('div', { shouldForwardProp: (prop) => prop !== 'audio' })`\n  position: relative;\n  background-color: ${({ theme }) => theme.palette.primary.main};\n  color: ${({ theme }) => theme.palette.primary.contrastText};\n  padding: ${({ theme }) => theme.spacing(1, 2)};\n  padding-right: ${({ theme, audio }) => (audio ? theme.spacing(6) : theme.spacing(2))};\n  border-radius: 1rem;\n  border-top-right-radius: 0;\n  align-self: flex-end;\n  max-width: 80%;\n  word-wrap: break-word;\n`;\n\n\n  const AgentMessage = styled('div')`\nposition: relative;\nbackground-color: ${({ theme }) => theme.palette.grey[300]};\ncolor: ${({ theme }) => theme.palette.text.primary};\npadding: ${({ theme }) => theme.spacing(1, 2)};\nborder-radius: 1rem;\nborder-top-left-radius: 0;\nalign-self: flex-end;\nmax-width: 80%;\nword-wrap: break-word;\n`;\n\n\n  const MessageWrapper = styled('div')`\ndisplay: flex;\nmargin-bottom: ${({ theme }) => theme.spacing(1)};\njustify-content: ${({ align }) => (align === 'user' ? 'flex-end' : 'flex-start')};\n`;\n\n  const ChatMessages = ({ messages }) => {\n    const theme = useTheme();\n    const bottomRef = useRef(null);\n\n    const scrollToBottom = () => {\n      if (bottomRef.current) {\n        if (typeof bottomRef.current.scrollIntoViewIfNeeded === 'function') {\n          bottomRef.current.scrollIntoViewIfNeeded({ behavior: 'smooth' });\n        } else {\n          bottomRef.current.scrollIntoView({ behavior: 'smooth' });\n        }\n      }\n    };\n\n    // Hook that scrolls the chat to the bottom whenever the messages prop changes\n    useEffect(() => {\n      scrollToBottom();\n    }, [messages]);\n\n\n    return (\n      <Container>\n        <Box sx={{ width: '100%', mt: 4, maxHeight: 300, minHeight: 300, overflow: 'auto' }}>\n          <Paper elevation={0} sx={{ padding: 2 }}>\n            <List>\n              {messages.map((message, index) => (\n                <ListItem key={index} sx={{ padding: 0 }}>\n                  <ListItemText\n                    sx={{ margin: 0 }}\n                    primary={\n                      <MessageWrapper align={message.role}>\n                        {message.role === 'user' ? (\n                          <>\n                            <UserMessage theme={theme} audio={message.audio}>\n                              {message.text}\n                              {message.audio && (\n                                <IconButton\n                                  size=\"small\"\n                                  sx={{\n                                    position: 'absolute',\n                                    top: '50%',\n                                    right: 8,\n                                    transform: 'translateY(-50%)'\n                                  }}\n                                  onClick={() => message.audio.play()}\n                                >\n                                  <VolumeUpIcon fontSize=\"small\" />\n                                </IconButton>\n                              )}\n                            </UserMessage>\n                          </>\n                        ) : (\n                          <AgentMessage theme={theme}>\n                            {message.text}\n                          </AgentMessage>\n                        )}\n                      </MessageWrapper>\n                    }\n                  />\n                </ListItem>\n              ))}\n              <div ref={bottomRef} />\n            </List>\n          </Paper>\n        </Box>\n      </Container>\n    )\n\n  }\n\n  function filterMessageObjects(list) {\n    return list.map(({ role, content }) => ({ role, content }));\n  }\n\n\n  const handleSendMessage = async () => {\n\n    if (message.trim() !== \"\") {\n\n      // Send the message to the chat\n\n      // Add the new message to the chat area\n      setMessages((prevMessages) => [\n        ...prevMessages,\n        { role: \"user\", content: message, text: message, audio: null },\n      ]);\n\n      // Clear the input field\n      setMessage(\"\");\n\n      // Add thinking bubble\n      setMessages((prevMessages) => [\n        ...prevMessages,\n        { role: \"assistant\", content: <ThinkingBubble theme={theme} sx={{ marginBottom: '-5px' }} />, text: <ThinkingBubble theme={theme} sx={{ marginBottom: '-5px' }} />, key: \"thinking\" },\n      ]);\n\n      // Create backend chat input\n      let messageObjects = filterMessageObjects(messages)\n      messageObjects.push({ role: \"user\", content: message })\n\n      // Create endpoint for just getting the completion\n      try {\n        // Send the text message to the backend\n        const response = await API.post(\"api\", \"/get-answer\", {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: {\n            text: message,\n            messages: messageObjects,\n            isAudioResponse\n          },\n        });\n\n\n        handleBackendResponse(response); // Add function call\n\n      } catch (error) {\n        console.error(\"Error sending text message:\", error);\n        alert(error);\n      }\n\n      // Remove the thinking bubble\n      setMessages((prevMessages) => {\n        return prevMessages.filter((message) => message.key !== \"thinking\");\n      });\n\n    }\n  };\n\n  const handleBackendResponse = (response, id = null) => {\n\n    const generatedText = response.generated_text;\n    const generatedAudio = response.generated_audio;\n    const transcription = response.transcription;\n\n\n    const audioElement = generatedAudio\n      ? new Audio(`data:audio/mpeg;base64,${generatedAudio}`)\n      : null;\n\n\n    const AudioMessage = () => (\n      <span>\n        {generatedText}{\" \"}\n        {audioElement && (\n          <IconButton\n            aria-label=\"play-message\"\n            onClick={() => {\n              audioElement.play();\n            }}\n          >\n            <VolumeUpIcon style={{ cursor: \"pointer\" }} fontSize=\"small\" />\n          </IconButton>\n        )}\n      </span>\n    );\n\n    if (id) {\n      setMessages((prevMessages) => {\n        const updatedMessages = prevMessages.map((message) => {\n          if (message.id && message.id === id) {\n            return {\n              ...message,\n              content: transcription,\n            };\n          }\n          return message;\n        });\n        return [\n          ...updatedMessages,\n          {\n            role: \"assistant\",\n            content: generatedText,\n            audio: audioElement,\n            text: <AudioMessage />,\n          },\n        ];\n      });\n    } else {\n      // Simply add the response when no messageId is involved\n      setMessages((prevMessages) => [\n        ...prevMessages,\n        {\n          role: \"assistant\",\n          content: generatedText,\n          audio: audioElement,\n          text: <AudioMessage />,\n        },\n      ]);\n    }\n\n  }\n\n  return (\n\n    <Container maxWidth=\"sm\" sx={{ pt: 2 }}>\n      <ChatHeader />\n      <ChatMessages messages={messages} />\n      <AudioControls isAudioResponse={isAudioResponse} filterMessageObjects={filterMessageObjects} messages={messages} setMessages={setMessages} handleBackendResponse={handleBackendResponse} />\n      <MessageInput message={message} setMessage={setMessage} isAudioResponse={isAudioResponse} handleSendMessage={handleSendMessage} handleBackendResponse={handleBackendResponse} />\n      <ResponseFormatToggle isAudioResponse={isAudioResponse} setIsAudioResponse={setIsAudioResponse} />\n    </Container>\n\n  );\n}\n\nexport default App;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}